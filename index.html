<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>IoT Fuzzy Infrared Therapy (WIB)</title>

  <!-- Firebase SDK v9 compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    *{
      box-sizing:border-box;
    }

    body{
      margin:0;
      padding:16px;
      font-family:'Poppins',sans-serif;
      background:linear-gradient(180deg,#e0f7fa,#80deea);
      color:#004d40;
    }

    h1{
      text-align:center;
      font-size:22px;
      margin-bottom:18px;
    }

    .container{
      max-width:420px;
      margin:auto;
    }

    .card{
      background:#ffffff;
      border-radius:18px;
      padding:14px;
      margin-bottom:12px;
      box-shadow:0 6px 14px rgba(0,0,0,0.15);
    }

    .card h3{
      margin:0;
      font-size:14px;
      font-weight:600;
      color:#00695c;
    }

    .value{
      margin-top:6px;
      font-size:26px;
      font-weight:bold;
      color:#00796b;
    }

    .status-aktif{
      color:#2e7d32;
    }

    .status-standby{
      color:#616161;
    }

    .timer{
      display:flex;
      justify-content:space-between;
      gap:8px;
      margin-top:10px;
    }

    .timer div{
      flex:1;
      text-align:center;
    }

    .timer label{
      font-size:12px;
      display:block;
      margin-bottom:4px;
    }

    input{
      width:100%;
      padding:8px;
      border-radius:10px;
      border:1px solid #b2dfdb;
      text-align:center;
      font-size:16px;
    }

    .btn-group{
      display:flex;
      gap:10px;
      margin-top:16px;
    }

    .btn{
      flex:1;
      border:none;
      border-radius:14px;
      padding:12px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
    }

    .btn-start{
      background:#00897b;
      color:white;
    }

    .btn-stop{
      background:#e53935;
      color:white;
    }

    .footer{
      margin-top:24px;
      text-align:center;
      font-size:12px;
      color:#555;
    }
  </style>
</head>

<body>

<div class="container">

  <h1>üå° IoT Fuzzy Infrared Therapy</h1>

  <div class="card">
    <h3>üïí Waktu (WIB)</h3>
    <div id="jam" class="value">--:--:--</div>
  </div>

  <div class="card">
    <h3>üå° Suhu (¬∞C)</h3>
    <div id="suhu" class="value">--</div>
  </div>

  <div class="card">
    <h3>üìè Jarak (cm)</h3>
    <div id="jarak" class="value">--</div>
  </div>

  <div class="card">
    <h3>üî• Daya (%)</h3>
    <div id="daya" class="value">--</div>
  </div>

  <div class="card">
    <h3>üïì Status</h3>
    <div id="status" class="value">--</div>
  </div>

  <div class="card">
    <h3>‚è±Ô∏è Atur Durasi Timer</h3>

    <div class="timer">
      <div>
        <label>Jam</label>
        <input id="durH" type="number" min="0" max="23" value="0">
      </div>
      <div>
        <label>Menit</label>
        <input id="durM" type="number" min="0" max="59" value="0">
      </div>
      <div>
        <label>Detik</label>
        <input id="durS" type="number" min="0" max="59" value="0">
      </div>
    </div>

    <div class="btn-group">
      <button class="btn btn-start" onclick="startTimer()">‚ñ∂ Mulai</button>
      <button class="btn btn-stop" onclick="stopTimer()">‚ñ† Stop</button>
    </div>
  </div>

  <div class="footer">
    ESP32 ‚Ä¢ Firebase RTDB ‚Ä¢ Fuzzy Logic ‚Ä¢ RTC NTP (WIB)
  </div>

</div>

<script>
  // ===== Firebase Config =====
  const firebaseConfig = {
    apiKey: "AIzaSyD-g4X4wy0F2SO3i8lYWdiROl5zE03Mgww",
    authDomain: "iot-fuzzy-infrared.firebaseapp.com",
    databaseURL: "https://iot-fuzzy-infrared-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "iot-fuzzy-infrared",
    storageBucket: "iot-fuzzy-infrared.firebasestorage.app",
    messagingSenderId: "236929233290",
    appId: "1:236929233290:web:2c41b02f927de250c89873"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const jam    = document.getElementById("jam");
  const suhu   = document.getElementById("suhu");
  const jarak  = document.getElementById("jarak");
  const daya   = document.getElementById("daya");
  const status = document.getElementById("status");

  db.ref("iot/data").on("value", snap => {
    const d = snap.val();
    if(!d) return;

    jam.textContent   = d.jam ?? "--:--:--";
    suhu.textContent  = d.suhu ?? "--";
    jarak.textContent = d.jarak ?? "--";
    daya.textContent  = d.daya ?? "--";

    status.textContent = d.status ?? "--";
    if(d.status && d.status.startsWith("Aktif")){
      status.className = "value status-aktif";
    } else {
      status.className = "value status-standby";
    }
  });

  function startTimer(){
    db.ref("iot/command").set({
      action:"start",
      durH:Number(durH.value||0),
      durM:Number(durM.value||0),
      durS:Number(durS.value||0)
    });
  }

  function stopTimer(){
    db.ref("iot/command").set({ action:"stop" });
  }
</script>

</body>
</html>
